<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>join-test</title>

	<script>
		const rndHex = size => [...Array(size)].map(() => Math.floor(Math.random() * 16).toString(16)).join('');
		const joinDto = () => {
			return {
				type: 'join',
				id: rndHex(16),
				data: {
					nickName: 'Tester' + ~~(Math.random() * 10000),
					class: 'tank',
				}
			}
		}
		const lobbyStatusDto = () => {
			return {
				type: 'lobbyStatus',
				id: rndHex(16),
			}
		}
		const shopStatusDto = () => {
			return {
				type: 'shopStatus',
				id: rndHex(16),
			}
		}
		const shopPurchaseDto = () => {
			return {
				type: 'shopAction',
				id: rndHex(16),
				data: {
					action: "buy",
					itemUid: 1,
					quantity: 10,
				}
			}
		}
		const createRoomDto = () => {
			return {
				type: 'createRoom',
				id: rndHex(16),
				data: {
					capacity: 4,
				}
			}
		}

		const ws = new WebSocket('ws://localhost:3000/ws');
		const scenario = [
			joinDto,
			lobbyStatusDto,
			shopStatusDto,
			shopPurchaseDto,
			shopPurchaseDto,
			createRoomDto
		];
		const next = () => {
			if (!scenario.length) return;
			const request = JSON.stringify(scenario.shift()());
			console.log('Request: ', request);
			ws.send(request);
		}
		ws.onopen = (event) => {
			console.log('Joined:', event);
			next();
		}
		ws.onclose = (event) => {
			console.log('Disconnected:', event);
		}
		ws.onmessage = (event) => {
			console.log('Response:', event.data);
			const response = JSON.parse(event.data);
			next();
		}
		ws.onerror = function (evt) {
			console.log('Error:', evt.data);
		}


	</script>
</head>

<body>

</body>

</html>